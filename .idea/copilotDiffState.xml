<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/.gitignore">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/.gitignore" />
              <option name="updatedContent" value="# Compiled class files&#10;*.class&#10;&#10;# Log files&#10;*.log&#10;&#10;# Maven&#10;target/&#10;**/target/&#10;&#10;# Package Files&#10;*.jar&#10;*.war&#10;*.nar&#10;*.ear&#10;*.zip&#10;*.tar.gz&#10;*.rar&#10;&#10;# Virtual machine crash logs&#10;hs_err_pid*&#10;replay_pid*&#10;&#10;# IDE files&#10;.idea/&#10;*.iml&#10;.vscode/&#10;.settings/&#10;.project&#10;.classpath&#10;&#10;# OS files&#10;.DS_Store&#10;Thumbs.db&#10;&#10;# H2 Database files (optionnel - décommentez si vous voulez ignorer les bases de données)&#10;# data/*.db&#10;# data/*.mv.db&#10;# data/*.trace.db&#10;&#10;# Logs directory&#10;logs/&#10;*.log.*&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/BDD-H2-REST-VS-GRPC.md">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/BDD-H2-REST-VS-GRPC.md" />
              <option name="updatedContent" value="# ️ Base de données H2 : REST vs gRPC&#10;&#10;## ✅ RÉPONSE COURTE&#10;&#10;**La base de données H2 fonctionne EXACTEMENT de la même façon entre REST et gRPC !**&#10;&#10;Il n'y a **AUCUN changement** au niveau de la couche persistance. Seule la **couche de communication** a changé (REST → gRPC).&#10;&#10;---&#10;&#10;##  Architecture en couches&#10;&#10;### Architecture AVANT (REST)&#10;&#10;```&#10;┌─────────────────────────────────────────┐&#10;│         CLIENT (Interface Swing)         │&#10;└─────────────────┬───────────────────────┘&#10;                  │ HTTP REST&#10;                  ▼&#10;┌─────────────────────────────────────────┐&#10;│      AGENCE (REST Controller)           │&#10;└─────────────────┬───────────────────────┘&#10;                  │ HTTP REST&#10;                  ▼&#10;┌─────────────────────────────────────────┐&#10;│      HOTELLERIE (REST Controller)       │ ← Couche communication REST&#10;├─────────────────────────────────────────┤&#10;│      HotelService (@Service)            │ ← Couche métier (INCHANGÉE)&#10;├─────────────────────────────────────────┤&#10;│   Repositories JPA (@Repository)        │ ← Couche persistance (INCHANGÉE)&#10;├─────────────────────────────────────────┤&#10;│   Entités JPA (@Entity)                 │ ← Modèle de données (INCHANGÉ)&#10;├─────────────────────────────────────────┤&#10;│   Base H2 (fichier .mv.db)              │ ← Base de données (INCHANGÉE)&#10;└─────────────────────────────────────────┘&#10;```&#10;&#10;### Architecture MAINTENANT (gRPC)&#10;&#10;```&#10;┌─────────────────────────────────────────┐&#10;│         CLIENT (Interface Swing)         │&#10;└─────────────────┬───────────────────────┘&#10;                  │ gRPC&#10;                  ▼&#10;┌─────────────────────────────────────────┐&#10;│      AGENCE (gRPC Service)              │&#10;└─────────────────┬───────────────────────┘&#10;                  │ gRPC&#10;                  ▼&#10;┌─────────────────────────────────────────┐&#10;│   HOTELLERIE (HotelGrpcService)         │ ← Couche communication gRPC (NOUVELLE)&#10;├─────────────────────────────────────────┤&#10;│   HotelService (@Service)               │ ← Couche métier (INCHANGÉE) ✅&#10;├─────────────────────────────────────────┤&#10;│   Repositories JPA (@Repository)        │ ← Couche persistance (INCHANGÉE) ✅&#10;├─────────────────────────────────────────┤&#10;│   Entités JPA (@Entity)                 │ ← Modèle de données (INCHANGÉ) ✅&#10;├─────────────────────────────────────────┤&#10;│   Base H2 (fichier .mv.db)              │ ← Base de données (INCHANGÉE) ✅&#10;└─────────────────────────────────────────┘&#10;```&#10;&#10;** Seule la couche de communication a changé !**&#10;&#10;---&#10;&#10;##  Preuve : Le code de persistance est IDENTIQUE&#10;&#10;### 1. Les entités JPA (@Entity) - INCHANGÉES&#10;&#10;```java&#10;// Chambre.java&#10;@Entity&#10;@Table(name = &quot;chambres&quot;)&#10;public class Chambre {&#10;    @Id&#10;    @GeneratedValue(strategy = GenerationType.IDENTITY)&#10;    private Long id;&#10;    &#10;    private String nom;&#10;    private Float prix;&#10;    private Integer nbrDeLit;&#10;    private String imageUrl;&#10;    &#10;    @ManyToOne&#10;    @JoinColumn(name = &quot;hotel_id&quot;)&#10;    private Hotel hotel;&#10;    &#10;    // Getters/Setters&#10;}&#10;&#10;// Reservation.java&#10;@Entity&#10;@Table(name = &quot;reservations&quot;)&#10;public class Reservation {&#10;    @Id&#10;    @GeneratedValue(strategy = GenerationType.IDENTITY)&#10;    private Long id;&#10;    &#10;    @ManyToOne&#10;    private Chambre chambre;&#10;    &#10;    @ManyToOne&#10;    private Client client;&#10;    &#10;    private String dateArrive;&#10;    private String dateDepart;&#10;    &#10;    // Getters/Setters&#10;}&#10;```&#10;&#10;**✅ Aucun changement dans les entités !**&#10;&#10;### 2. Les repositories JPA - INCHANGÉS&#10;&#10;```java&#10;@Repository&#10;public interface ChambreRepository extends JpaRepository&lt;Chambre, Long&gt; {&#10;    List&lt;Chambre&gt; findByHotelId(Long hotelId);&#10;    long countByHotelId(Long hotelId);&#10;}&#10;&#10;@Repository&#10;public interface ReservationRepository extends JpaRepository&lt;Reservation, Long&gt; {&#10;    List&lt;Reservation&gt; findByHotelId(Long hotelId);&#10;    long countByHotelId(Long hotelId);&#10;}&#10;```&#10;&#10;**✅ Aucun changement dans les repositories !**&#10;&#10;### 3. Le service métier (HotelService) - INCHANGÉ&#10;&#10;```java&#10;@Service&#10;@Transactional&#10;public class HotelService {&#10;    &#10;    @Autowired&#10;    private HotelRepository hotelRepository;&#10;    &#10;    @Autowired&#10;    private ChambreRepository chambreRepository;&#10;    &#10;    @Autowired&#10;    private ReservationRepository reservationRepository;&#10;    &#10;    @Autowired&#10;    private ClientRepository clientRepository;&#10;    &#10;    // Méthodes métier INCHANGÉES&#10;    public List&lt;Chambre&gt; rechercherChambres(...) {&#10;        // Utilise chambreRepository.findByHotelId()&#10;        // MÊME CODE qu'avant !&#10;    }&#10;    &#10;    public ReservationResult effectuerReservation(...) {&#10;        // Utilise reservationRepository.save()&#10;        // MÊME CODE qu'avant !&#10;    }&#10;    &#10;    public List&lt;ChambreDTO&gt; getChambresReservees() {&#10;        // Utilise reservationRepository.findByHotelId()&#10;        // MÊME CODE qu'avant !&#10;    }&#10;}&#10;```&#10;&#10;**✅ HotelService utilise TOUJOURS les mêmes repositories JPA !**&#10;&#10;### 4. La configuration de la base H2 - INCHANGÉE&#10;&#10;```properties&#10;# application-paris.properties&#10;&#10;# Base de données H2 (IDENTIQUE)&#10;spring.datasource.url=jdbc:h2:file:./data/hotellerie-paris-db&#10;spring.datasource.driverClassName=org.h2.Driver&#10;spring.datasource.username=sa&#10;spring.datasource.password=&#10;&#10;# JPA/Hibernate (IDENTIQUE)&#10;spring.jpa.database-platform=org.hibernate.dialect.H2Dialect&#10;spring.jpa.hibernate.ddl-auto=update&#10;spring.jpa.show-sql=false&#10;&#10;# Console H2 (IDENTIQUE)&#10;spring.h2.console.enabled=true&#10;spring.h2.console.path=/h2-console&#10;```&#10;&#10;**✅ Configuration H2 identique !**&#10;&#10;---&#10;&#10;##  Comment ça fonctionne maintenant ?&#10;&#10;### Exemple : Effectuer une réservation&#10;&#10;#### AVANT (REST)&#10;```&#10;CLIENT REST&#10;    │&#10;    │ POST /reservations (JSON)&#10;    ▼&#10;HotelController (@RestController)&#10;    │&#10;    │ hotelService.effectuerReservation(...)&#10;    ▼&#10;HotelService (@Service)&#10;    │&#10;    │ reservationRepository.save(...)&#10;    ▼&#10;Base H2&#10;```&#10;&#10;#### MAINTENANT (gRPC)&#10;```&#10;CLIENT gRPC&#10;    │&#10;    │ RPC effectuerReservation (Protobuf)&#10;    ▼&#10;HotelGrpcService (@GrpcService)&#10;    │&#10;    │ hotelService.effectuerReservation(...)  ← MÊME APPEL !&#10;    ▼&#10;HotelService (@Service)&#10;    │&#10;    │ reservationRepository.save(...)  ← MÊME CODE !&#10;    ▼&#10;Base H2  ← MÊME BASE !&#10;```&#10;&#10;** Seule la couche de réception de la requête a changé (REST → gRPC)**&#10;&#10;---&#10;&#10;##  Ce qui a changé vs ce qui est resté identique&#10;&#10;### ❌ A CHANGÉ : Couche de communication&#10;&#10;| Aspect | AVANT (REST) | MAINTENANT (gRPC) |&#10;|--------|--------------|-------------------|&#10;| **Contrôleur** | `HotelController` avec `@RestController` | `HotelGrpcService` avec `@GrpcService` |&#10;| **Endpoints** | HTTP REST (`/chambres`, `/reservations`) | RPC gRPC (`rechercherChambres`, `effectuerReservation`) |&#10;| **Format de données** | JSON | Protocol Buffers (binaire) |&#10;| **Transport** | HTTP/1.1 | HTTP/2 |&#10;| **Annotations** | `@GetMapping`, `@PostMapping` | `@Override` des méthodes gRPC |&#10;&#10;### ✅ INCHANGÉ : Tout le reste !&#10;&#10;| Aspect | Statut |&#10;|--------|--------|&#10;| **Entités JPA** (`@Entity`) | ✅ IDENTIQUES |&#10;| **Repositories** (`@Repository`) | ✅ IDENTIQUES |&#10;| **Service métier** (`HotelService`) | ✅ IDENTIQUE |&#10;| **Base de données H2** | ✅ IDENTIQUE |&#10;| **Fichiers de données** (`hotellerie-paris-db.mv.db`) | ✅ IDENTIQUES |&#10;| **Configuration H2** | ✅ IDENTIQUE |&#10;| **Schéma de base** (tables, colonnes) | ✅ IDENTIQUE |&#10;| **Logique métier** (recherche, réservation) | ✅ IDENTIQUE |&#10;&#10;---&#10;&#10;##  Structure des fichiers de base H2&#10;&#10;```&#10;gRPCRepo/&#10;└── Hotellerie/&#10;    └── data/&#10;        ├── hotellerie-paris-db.mv.db       ← Base H2 Paris (INCHANGÉE)&#10;        ├── hotellerie-lyon-db.mv.db        ← Base H2 Lyon (INCHANGÉE)&#10;        └── hotellerie-montpellier-db.mv.db ← Base H2 Montpellier (INCHANGÉE)&#10;```&#10;&#10;**Ces fichiers :**&#10;- ✅ Sont les MÊMES qu'avant&#10;- ✅ Contiennent les MÊMES données&#10;- ✅ Utilisent le MÊME schéma&#10;- ✅ Fonctionnent de la MÊME façon&#10;&#10;---&#10;&#10;##  Exemple concret : Méthode getChambresReservees()&#10;&#10;### Dans HotelService (INCHANGÉ)&#10;&#10;```java&#10;@Service&#10;@Transactional&#10;public class HotelService {&#10;    &#10;    public List&lt;ChambreDTO&gt; getChambresReservees() {&#10;        List&lt;Reservation&gt; reservations = reservationRepository.findByHotelId(hotelId);&#10;        &#10;        return reservations.stream()&#10;            .map(reservation -&gt; {&#10;                Chambre chambre = reservation.getChambre();&#10;                return new ChambreDTO(&#10;                    chambre.getId(),&#10;                    chambre.getNom(),&#10;                    chambre.getPrix(),&#10;                    chambre.getNbrDeLit(),&#10;                    // ...&#10;                );&#10;            })&#10;            .collect(Collectors.toList());&#10;    }&#10;}&#10;```&#10;&#10;**Cette méthode :**&#10;- ✅ Existe depuis le début (version REST)&#10;- ✅ Utilise `reservationRepository` (JPA)&#10;- ✅ Interroge la base H2&#10;- ✅ N'a PAS changé !&#10;&#10;### Dans HotelGrpcService (NOUVEAU - appelle la méthode existante)&#10;&#10;```java&#10;@GrpcService&#10;public class HotelGrpcService extends HotelServiceGrpc.HotelServiceImplBase {&#10;    &#10;    @Autowired&#10;    private HotelService hotelService;  // ← Le MÊME service métier !&#10;    &#10;    @Override&#10;    public void getChambresReservees(ChambresReserveesRequest request,&#10;                                     StreamObserver&lt;ChambresReserveesResponse&gt; responseObserver) {&#10;        &#10;        // 1. Appeler le service métier EXISTANT&#10;        List&lt;ChambreDTO&gt; chambresReservees = hotelService.getChambresReservees();&#10;        //                                    ↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑&#10;        //                         MÊME MÉTHODE qu'avant (accède à la BDD H2)&#10;        &#10;        // 2. Convertir DTO → Proto (NOUVEAU)&#10;        List&lt;ChambreMessage&gt; chambreMessages = chambresReservees.stream()&#10;            .map(chambre -&gt; ChambreMessage.newBuilder()&#10;                .setId(chambre.getId())&#10;                .setNom(chambre.getNom())&#10;                .setPrix(chambre.getPrix())&#10;                .build())&#10;            .collect(Collectors.toList());&#10;        &#10;        // 3. Retourner la réponse gRPC (NOUVEAU format)&#10;        ChambresReserveesResponse response = ChambresReserveesResponse.newBuilder()&#10;            .addAllChambres(chambreMessages)&#10;            .build();&#10;        &#10;        responseObserver.onNext(response);&#10;        responseObserver.onCompleted();&#10;    }&#10;}&#10;```&#10;&#10;**Ce qui est nouveau :**&#10;- ❌ Le format de réponse (Protocol Buffers au lieu de JSON)&#10;- ❌ L'interface gRPC (StreamObserver au lieu de ResponseEntity)&#10;&#10;**Ce qui est IDENTIQUE :**&#10;- ✅ L'appel à `hotelService.getChambresReservees()`&#10;- ✅ L'accès à la base H2&#10;- ✅ La logique métier&#10;- ✅ Les données retournées&#10;&#10;---&#10;&#10;##  Analogie simple&#10;&#10;Imaginez une bibliothèque :&#10;&#10;**AVANT (REST) :**&#10;```&#10;Vous demandez un livre par téléphone (REST/JSON)&#10;    ↓&#10;Le bibliothécaire cherche dans le catalogue (HotelService)&#10;    ↓&#10;Il va dans les étagères (Base H2)&#10;    ↓&#10;Il vous rappelle avec les infos (JSON)&#10;```&#10;&#10;**MAINTENANT (gRPC) :**&#10;```&#10;Vous demandez un livre par email (gRPC/Protobuf)&#10;    ↓&#10;Le bibliothécaire cherche dans le catalogue (HotelService) ← MÊME PERSONNE !&#10;    ↓&#10;Il va dans les étagères (Base H2) ← MÊMES ÉTAGÈRES !&#10;    ↓&#10;Il vous répond par email avec les infos (Protobuf)&#10;```&#10;&#10;** Le bibliothécaire (HotelService) et les étagères (Base H2) n'ont PAS changé !**&#10;&#10;Seul le **moyen de communication** a changé (téléphone → email).&#10;&#10;---&#10;&#10;##  Points clés à retenir&#10;&#10;1. ✅ **La base H2 est IDENTIQUE** (mêmes fichiers `.mv.db`, même schéma)&#10;2. ✅ **Les entités JPA sont IDENTIQUES** (même `@Entity`, mêmes champs)&#10;3. ✅ **Les repositories sont IDENTIQUES** (mêmes requêtes JPA)&#10;4. ✅ **Le service métier est IDENTIQUE** (même logique)&#10;5. ❌ **Seule la couche de communication a changé** (REST → gRPC)&#10;&#10;---&#10;&#10;##  Schéma de base de données (INCHANGÉ)&#10;&#10;```sql&#10;-- Table: hotels&#10;CREATE TABLE hotels (&#10;    id BIGINT PRIMARY KEY AUTO_INCREMENT,&#10;    nom VARCHAR(255),&#10;    adresse VARCHAR(255),&#10;    type VARCHAR(50),&#10;    ville VARCHAR(100),&#10;    telephone VARCHAR(50)&#10;);&#10;&#10;-- Table: chambres&#10;CREATE TABLE chambres (&#10;    id BIGINT PRIMARY KEY AUTO_INCREMENT,&#10;    nom VARCHAR(255),&#10;    prix FLOAT,&#10;    nbr_de_lit INTEGER,&#10;    image_url VARCHAR(500),&#10;    hotel_id BIGINT,&#10;    FOREIGN KEY (hotel_id) REFERENCES hotels(id)&#10;);&#10;&#10;-- Table: clients&#10;CREATE TABLE clients (&#10;    id BIGINT PRIMARY KEY AUTO_INCREMENT,&#10;    nom VARCHAR(255),&#10;    prenom VARCHAR(255),&#10;    numero_carte_bancaire VARCHAR(50)&#10;);&#10;&#10;-- Table: reservations&#10;CREATE TABLE reservations (&#10;    id BIGINT PRIMARY KEY AUTO_INCREMENT,&#10;    chambre_id BIGINT,&#10;    client_id BIGINT,&#10;    hotel_id BIGINT,&#10;    date_arrive VARCHAR(50),&#10;    date_depart VARCHAR(50),&#10;    FOREIGN KEY (chambre_id) REFERENCES chambres(id),&#10;    FOREIGN KEY (client_id) REFERENCES clients(id),&#10;    FOREIGN KEY (hotel_id) REFERENCES hotels(id)&#10;);&#10;```&#10;&#10;**Ce schéma est LE MÊME qu'avant la migration vers gRPC !**&#10;&#10;---&#10;&#10;## ✅ CONCLUSION&#10;&#10;### La base de données H2 fonctionne EXACTEMENT de la même façon !&#10;&#10;**Aucun changement au niveau :**&#10;- ❌ Des fichiers de base (`.mv.db`)&#10;- ❌ Du schéma (tables, colonnes)&#10;- ❌ Des entités JPA&#10;- ❌ Des repositories&#10;- ❌ Du service métier&#10;- ❌ De la configuration H2&#10;&#10;**Seul changement :**&#10;- ✅ La couche de communication (REST → gRPC)&#10;&#10;**En résumé :**&#10;```&#10;HotelGrpcService (NOUVEAU) → HotelService (INCHANGÉ) → Repositories (INCHANGÉS) → Base H2 (INCHANGÉE)&#10;```&#10;&#10;**La migration REST → gRPC n'a eu AUCUN impact sur la couche persistance !** &#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>